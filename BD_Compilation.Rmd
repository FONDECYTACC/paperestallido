---
title: "Compilation"
author: "ags"
date: "03-02-2021"
output: html_document
---

<style type="text/css">
.tablelines table, .tablelines td, .tablelines th {
  border: 1px solid black;
  }
.centrado {
  text-align: center;
}
.table.center {
  margin-left:auto; 
  margin-right:auto;
}
.table_wrapper{
  display: block;
  overflow-x: auto;
  white-space: nowrap;
}
code.r{
  font-size: 8px;
}
body{ /* Normal  */
    text-align: justify;
}
.superbigimage{
  overflow-y:scroll;
  white-space: nowrap;
}
.superbigimage img{
  overflow-y: scroll;
  overflow-x: hidden;
}
p.comment {
  background-color: #FF7F79;
    padding: 10px;
  border: 1px solid black;
  margin-left: 25px;
  border-radius: 5px;
  font-style: italic;
}
</style>
```
```{=html}
<style>
  p.comment {
    background-color: #ff9a9a;
      padding: 10px;
    border: 1px solid red;
    margin-left: 25px;
    border-radius: 5px;
    font-style: italic;
  }

</style>

------------------------------------------------------------------------

```{r setup1, include=FALSE}

knitr::opts_chunk$set(echo = TRUE)
rm(list=ls());gc()

if(!require(here)){install.packages("here")}

#if(!require(groundhog)){install.packages("groundhog")}
answer <- "OK"
consent <- TRUE
#require(groundhog)
#library(groundhog)
#set.groundhog.folder(here::here())


#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:
#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:
#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:

try_with_time_limit <- function(expr, cpu = Inf, elapsed = Inf)
{
  y <- try({setTimeLimit(cpu, elapsed); expr}, silent = TRUE) 
  if(inherits(y, "try-error")) NULL else y 
}
eval_fork <- function(..., timeout=60){

  #this limit must always be higher than the timeout on the fork!
  setTimeLimit(timeout+5);      

  #dispatch based on method
  ##NOTE!!!!! Due to a bug in mcparallel, we cannot use silent=TRUE for now.
  myfork <- parallel::mcparallel({
    eval(...)
  }, silent=FALSE);

  #wait max n seconds for a result.
  myresult <- parallel::mccollect(myfork, wait=FALSE, timeout=timeout);

  #try to avoid bug/race condition where mccollect returns null without waiting full timeout.
  #see https://github.com/jeroenooms/opencpu/issues/131
  #waits for max another 2 seconds if proc looks dead 
  while(is.null(myresult) && totaltime < timeout && totaltime < 2) {
     Sys.sleep(.1)
     enddtime <- Sys.time();
     totaltime <- as.numeric(enddtime - starttime, units="secs")
     myresult <- parallel::mccollect(myfork, wait = FALSE, timeout = timeout);
  }

  #kill fork after collect has returned
  tools::pskill(myfork$pid, tools::SIGKILL);    
  tools::pskill(-1 * myfork$pid, tools::SIGKILL);  

  #clean up:
  parallel::mccollect(myfork, wait=FALSE);

  #timeout?
  if(is.null(myresult)){
    stop("R call did not return within ", timeout, " seconds. Terminating process.", call.=FALSE);      
  }

  #move this to distinguish between timeout and NULL returns
  myresult <- myresult[[1]];

  #reset timer
  setTimeLimit();     

  #forks don't throw errors themselves
  if(inherits(myresult,"try-error")){
    #stop(myresult, call.=FALSE);
    stop(attr(myresult, "condition"));
  }

  #send the buffered response
  return(myresult);  
}
```
```{r setup2, include=FALSE}
local({r <- getOption("repos")
       r["CRAN"] <- "http://cran.r-project.org" 
       options(repos=r)
})

`%>%` <- magrittr::`%>%`

copy_names <- function(x,row.names=FALSE,col.names=TRUE,dec=",",...) {
  if(class(ungroup(x))[1]=="tbl_df"){
        if(options()$OutDec=="."){
            options(OutDec = dec)
            write.table(format(data.frame(x)),"clipboard",sep="\t",row.names=FALSE,col.names=col.names,...)
            options(OutDec = ".")
          return(x)
        } else {
            options(OutDec = ",")
            write.table(format(data.frame(x)),"clipboard",sep="\t",row.names=FALSE,col.names=col.names,...)
            options(OutDec = ",")
          return(x)    
        }
  } else {
        if(options()$OutDec=="."){
            options(OutDec = dec)
            write.table(format(x),"clipboard",sep="\t",row.names=FALSE,col.names=col.names,...)
            options(OutDec = ".")
          return(x)
        } else {
            options(OutDec = ",")
            write.table(format(x),"clipboard",sep="\t",row.names=FALSE,col.names=col.names,...)
            options(OutDec = ",")
          return(x)       
  }
 }
}  

if(!require(pacman)){install.packages("pacman")}

pacman::p_unlock(lib.loc = .libPaths()) #para no tener problemas reinstalando paquetes
knitr::opts_chunk$set(
	echo = TRUE,
	message = FALSE,
	warning = FALSE
)
#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:
#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:
#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:

#get.snowball(c("readr","RODBC","foreign","dplyr","tidyverse","lubridate"), "2020-02-01")
#groundhog.library('nlme','2021-01-01')
#groundhog.library('Matrix','2021-01-01')
#groundhog.library('MASS','2021-01-01')
#try_with_time_limit(groundhog.library("dplyr", "2020-11-01", ignore.deps = c("digest","generics", "glue", "magrittr", "pillar", "R6", "rlang", "tibble", "vctrs")))
#try_with_time_limit(groundhog.library("foreign", "2021-01-01"))
#try_with_time_limit(groundhog.library("readr", "2021-01-01"))
#try_with_time_limit(groundhog.library("RODBC", "2021-01-01"))

#try_with_time_limit(groundhog.library("tidyverse", "2021-01-01"))
#try_with_time_limit(groundhog.library("lubridate", "2021-01-01"))

#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:
#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:
#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:#:

if(!require(dplyr)){install.packages("dplyr")}
if(!require(foreign)){install.packages("foreign")}
if(!require(readr)){install.packages("readr")}
if(!require(RODBC)){install.packages("RODBC")}
if(!require(tidyverse)){install.packages("tidyverse")}
if(!require(lubridate)){install.packages("lubridate")}

```

## Unite Databases

We merge the datasets of yearly Urgency Admissions from 2015 to 2019, selecting the following causes (`Idcausa`):

a.  Total Consultations (1)
b.  Respiratory Consultations (2)
c.  Circulatory Consultations (12)
d.  Diarrhea Consultations (29)
e.  Trauma Consultations (18)
f.  Total Hospitalizations (25)
g.  Respiratory Hospitalizations (7)
h.  Circulatory Hospitalizations (22)
i.  Trauma Hospitalizations (23)

We selected the following healthcare institutions (`codigo_antiguo`) within 3KM:

-   Complejo Hospitalario San José (09-100)
-   Hospital de Urgencia Asistencia Pública (11-195)
-   Hospital del Salvador de Santiago (12-100)

```{r 1 - Urg15_3 Data Creation}
# -------- Access Data --------
#rm(list=setdiff(ls(), "dt"))
establecimientos <-
  readr::read_delim("establecimientos.csv",
             ";",
             escape_double = FALSE,
             trim_ws = TRUE)

target <- tempfile()
file.path(target)
unzip(paste0(getwd(), '/',"AtencionesUrg_15.zip"), exdir = target)
f <- list.files(target, pattern = ".mdb")
d5 <- RODBC::odbcConnectAccess2007(file.path(target, f))
#d5 <- RODBC::odbcConnectAccess2007("AtencionesUrgencia2015.mdb")
urg_2015 <- sqlFetch(d5, "Atenciones Urgencia 2015")
odbcClose(d5)
unlink(target)

# -------- Clean urg_2015 Columns --------
urg_2015$idestablecimiento <- urg_2015$IdEstablecimiento
urg_2015$Col01 <- urg_2015$Total
urg_2015$Col02 <- urg_2015$`Menores de 1 año`
urg_2015$Col03 <- urg_2015$`1-4 años`
urg_2015$Col04 <- urg_2015$`5-14 años`
urg_2015$Col05 <- urg_2015$`15-64 años`
urg_2015$Col06 <- urg_2015$`65 años y más`
urg_2015$Idcausa <- urg_2015$IdCausa
# -------- Establish Hospital ID Codes --------
estab_id <-
  establecimientos[establecimientos$codigo_antiguo == "09-100" |
                     establecimientos$codigo_antiguo == "11-195" |
                     establecimientos$codigo_antiguo == "12-100", "codigo_antiguo", drop =
                     TRUE]
estab_id <- as.factor(estab_id)
columns = c("idestablecimiento",
            "Col01",
            "Col02",
            "Col03",
            "Col04",
            "Col05",
            "Col06",
            "fecha")

# -------- Create Consultation Columns --------
cons_total <-
  urg_2015[urg_2015$Idcausa == 1 &
             urg_2015$idestablecimiento %in% estab_id, columns, drop = FALSE]
names(cons_total) <-
  c (
    "id",
    "cons_total_all",
    "cons_total_a1",
    "cons_total_1a4",
    "cons_total_5a14",
    "cons_total_15a64",
    "cons_total_65a",
    "date"
  )
cons_resp <-
  urg_2015[urg_2015$Idcausa == 2 &
             urg_2015$idestablecimiento %in% estab_id, columns, drop = FALSE]
names(cons_resp) <-
  c (
    "id",
    "cons_resp_all",
    "cons_resp_a1",
    "cons_resp_1a4",
    "cons_resp_5a14",
    "cons_resp_15a64",
    "cons_resp_65a",
    "date"
  )
cons_circ <-
  urg_2015[urg_2015$Idcausa == 12 &
             urg_2015$idestablecimiento %in% estab_id, columns, drop = FALSE]
names(cons_circ) <-
  c (
    "id",
    "cons_circ_all",
    "cons_circ_a1",
    "cons_circ_1a4",
    "cons_circ_5a14",
    "cons_circ_15a64",
    "cons_circ_65a",
    "date"
  )
cons_diarrea <-
  urg_2015[urg_2015$Idcausa == 29 &
             urg_2015$idestablecimiento %in% estab_id, columns, drop = FALSE]
names(cons_diarrea) <-
  c (
    "id",
    "cons_diarrea_all",
    "cons_diarrea_a1",
    "cons_diarrea_1a4",
    "cons_diarrea_5a14",
    "cons_diarrea_15a64",
    "cons_diarrea_65a",
    "date"
  )

cons_trauma <-
  urg_2015[urg_2015$Idcausa == 18  &
             urg_2015$idestablecimiento %in% estab_id, columns, drop = FALSE]
names(cons_trauma) <-
  c (
    "id",
    "cons_trauma_all",
    "cons_trauma_a1",
    "cons_trauma_1a4",
    "cons_trauma_5a14",
    "cons_trauma_15a64",
    "cons_trauma_65a",
    "date"
  )

# -------- Create Hospitalization Columns --------
hosp_total <-
  urg_2015[urg_2015$Idcausa == 25 &
             urg_2015$idestablecimiento %in% estab_id, columns, drop = FALSE]
names(hosp_total) <-
  c (
    "id",
    "hosp_total_all",
    "hosp_total_a1",
    "hosp_total_1a4",
    "hosp_total_5a14",
    "hosp_total_15a64",
    "hosp_total_65a",
    "date"
  )
hosp_resp <-
  urg_2015[urg_2015$Idcausa == 7 &
             urg_2015$idestablecimiento %in% estab_id, columns, drop = FALSE]
names(hosp_resp) <-
  c (
    "id",
    "hosp_resp_all",
    "hosp_resp_a1",
    "hosp_resp_1a4",
    "hosp_resp_5a14",
    "hosp_resp_15a64",
    "hosp_resp_65a",
    "date"
  )
hosp_circ <-
  urg_2015[urg_2015$Idcausa == 22 &
             urg_2015$idestablecimiento %in% estab_id, columns, drop = FALSE]
names(hosp_circ) <-
  c (
    "id",
    "hosp_circ_all",
    "hosp_circ_a1",
    "hosp_circ_1a4",
    "hosp_circ_5a14",
    "hosp_circ_15a64",
    "hosp_circ_65a",
    "date"
  )
hosp_trauma <-
  urg_2015[urg_2015$Idcausa == 23 &
             urg_2015$idestablecimiento %in% estab_id, columns, drop = FALSE]
names(hosp_trauma) <-
  c (
    "id",
    "hosp_trauma_all",
    "hosp_trauma_a1",
    "hosp_trauma_1a4",
    "hosp_trauma_5a14",
    "hosp_trauma_15a64",
    "hosp_trauma_65a",
    "date"
  )

# -------- Merge Columns Into One Dataset --------
cons <- merge(cons_total, cons_resp)
cons <- merge(cons, cons_circ)
cons <- merge(cons, cons_diarrea)
cons <- merge(cons, cons_trauma)

hosps <- merge(hosp_total, hosp_resp)
hosps <- merge(hosps, hosp_circ)
hosps <- merge(hosps, hosp_trauma)

urg15_3 <- merge(cons, hosps)

# -------- Write CSV File --------
#write_csv(urg15_3, "urg15_3.csv")
```

```{r 1 - Urg16_3 Data Creation}
# -------- Access Data --------
#rm(list=setdiff(ls(), "dt"))
establecimientos <-
  readr::read_delim("establecimientos.csv",
             ";",
             escape_double = FALSE,
             trim_ws = TRUE)

target <- tempfile()
file.path(target)
unzip(paste0(getwd(), '/',"AtencionesUrg_16.zip"), exdir = target)
f <- list.files(target, pattern = ".mdb")
d6 <- RODBC::odbcConnectAccess2007(file.path(target, f))
#d5 <- RODBC::odbcConnectAccess2007("AtencionesUrgencia2015.mdb")
urg_2016 <- sqlFetch(d6, "Atenciones Urgencia 2016")
odbcClose(d6)
unlink(target)


# -------- Clean urg_2016 Columns --------
urg_2016$idestablecimiento <- urg_2016$IdEstablecimiento
urg_2016$Col01 <- urg_2016$Total
urg_2016$Col02 <- urg_2016$`Menores de 1 año`
urg_2016$Col03 <- urg_2016$`1-4 años`
urg_2016$Col04 <- urg_2016$`5-14 años`
urg_2016$Col05 <- urg_2016$`15-64 años`
urg_2016$Col06 <- urg_2016$`65 años y más`
urg_2016$Idcausa <- urg_2016$IdCausa


# -------- Establish Hospital ID Codes --------
estab_id <-
  establecimientos[establecimientos$codigo_antiguo == "09-100" |
                     establecimientos$codigo_antiguo == "11-195" |
                     establecimientos$codigo_antiguo == "12-100", "codigo_antiguo", drop =
                     TRUE]
estab_id <- as.factor(estab_id)
columns = c("idestablecimiento",
            "Col01",
            "Col02",
            "Col03",
            "Col04",
            "Col05",
            "Col06",
            "fecha")

# -------- Create Consultation Columns --------
cons_total <-
  urg_2016[urg_2016$Idcausa == 1 &
             urg_2016$idestablecimiento %in% estab_id, columns, drop = FALSE]
names(cons_total) <-
  c (
    "id",
    "cons_total_all",
    "cons_total_a1",
    "cons_total_1a4",
    "cons_total_5a14",
    "cons_total_15a64",
    "cons_total_65a",
    "date"
  )
cons_resp <-
  urg_2016[urg_2016$Idcausa == 2 &
             urg_2016$idestablecimiento %in% estab_id, columns, drop = FALSE]
names(cons_resp) <-
  c (
    "id",
    "cons_resp_all",
    "cons_resp_a1",
    "cons_resp_1a4",
    "cons_resp_5a14",
    "cons_resp_15a64",
    "cons_resp_65a",
    "date"
  )
cons_circ <-
  urg_2016[urg_2016$Idcausa == 12 &
             urg_2016$idestablecimiento %in% estab_id, columns, drop = FALSE]
names(cons_circ) <-
  c (
    "id",
    "cons_circ_all",
    "cons_circ_a1",
    "cons_circ_1a4",
    "cons_circ_5a14",
    "cons_circ_15a64",
    "cons_circ_65a",
    "date"
  )
cons_diarrea <-
  urg_2016[urg_2016$Idcausa == 29 &
             urg_2016$idestablecimiento %in% estab_id, columns, drop = FALSE]
names(cons_diarrea) <-
  c (
    "id",
    "cons_diarrea_all",
    "cons_diarrea_a1",
    "cons_diarrea_1a4",
    "cons_diarrea_5a14",
    "cons_diarrea_15a64",
    "cons_diarrea_65a",
    "date"
  )

cons_trauma <-
  urg_2016[urg_2016$Idcausa == 18  &
             urg_2016$idestablecimiento %in% estab_id, columns, drop = FALSE]
names(cons_trauma) <-
  c (
    "id",
    "cons_trauma_all",
    "cons_trauma_a1",
    "cons_trauma_1a4",
    "cons_trauma_5a14",
    "cons_trauma_15a64",
    "cons_trauma_65a",
    "date"
  )

# -------- Create Hospitalization Columns --------
hosp_total <-
  urg_2016[urg_2016$Idcausa == 25 &
             urg_2016$idestablecimiento %in% estab_id, columns, drop = FALSE]
names(hosp_total) <-
  c (
    "id",
    "hosp_total_all",
    "hosp_total_a1",
    "hosp_total_1a4",
    "hosp_total_5a14",
    "hosp_total_15a64",
    "hosp_total_65a",
    "date"
  )
hosp_resp <-
  urg_2016[urg_2016$Idcausa == 7 &
             urg_2016$idestablecimiento %in% estab_id, columns, drop = FALSE]
names(hosp_resp) <-
  c (
    "id",
    "hosp_resp_all",
    "hosp_resp_a1",
    "hosp_resp_1a4",
    "hosp_resp_5a14",
    "hosp_resp_15a64",
    "hosp_resp_65a",
    "date"
  )
hosp_circ <-
  urg_2016[urg_2016$Idcausa == 22 &
             urg_2016$idestablecimiento %in% estab_id, columns, drop = FALSE]
names(hosp_circ) <-
  c (
    "id",
    "hosp_circ_all",
    "hosp_circ_a1",
    "hosp_circ_1a4",
    "hosp_circ_5a14",
    "hosp_circ_15a64",
    "hosp_circ_65a",
    "date"
  )
hosp_trauma <-
  urg_2016[urg_2016$Idcausa == 23 &
             urg_2016$idestablecimiento %in% estab_id, columns, drop = FALSE]
names(hosp_trauma) <-
  c (
    "id",
    "hosp_trauma_all",
    "hosp_trauma_a1",
    "hosp_trauma_1a4",
    "hosp_trauma_5a14",
    "hosp_trauma_15a64",
    "hosp_trauma_65a",
    "date"
  )

# -------- Merge Columns Into One Dataset --------
cons <- merge(cons_total, cons_resp)
cons <- merge(cons, cons_circ)
cons <- merge(cons, cons_diarrea)
cons <- merge(cons, cons_trauma)

hosps <- merge(hosp_total, hosp_resp)
hosps <- merge(hosps, hosp_circ)
hosps <- merge(hosps, hosp_trauma)

urg16_3 <- merge(cons, hosps)

# -------- Write CSV File --------
#write_csv(urg16_3, "urg16_3.csv")
```

```{r 1 - Urg17_3 Data Creation}
# -------- Access Data --------
#rm(list=setdiff(ls(), "dt"))
establecimientos <-
  readr::read_delim("establecimientos.csv",
             ";",
             escape_double = FALSE,
             trim_ws = TRUE)

#d7 <- RODBC::odbcConnectAccess2007("AtencionesUrgencia2017.mdb")
#urg_2017 <- sqlFetch(d7, "Atenciones Urgencia 2017")
#odbcClose(d7)

target <- tempfile()
file.path(target)
unzip(paste0(getwd(), '/',"AtencionesUrg_17.zip"), exdir = target)
f <- list.files(target, pattern = ".mdb")
d7 <- RODBC::odbcConnectAccess2007(file.path(target, f))
#d5 <- RODBC::odbcConnectAccess2007("AtencionesUrgencia2015.mdb")
urg_2017 <- sqlFetch(d7, "Atenciones Urgencia 2017")
odbcClose(d7)
unlink(target)


# -------- Establish Hospital ID Codes --------
estab_id <-
  establecimientos[establecimientos$codigo_antiguo == "09-100" |
                     establecimientos$codigo_antiguo == "11-195" |
                     establecimientos$codigo_antiguo == "12-100", "codigo_antiguo", drop =
                     TRUE]
estab_id <- as.factor(estab_id)
columns = c("idestablecimiento",
            "Col01",
            "Col02",
            "Col03",
            "Col04",
            "Col05",
            "Col06",
            "fecha")

# -------- Create Consultation Columns --------
cons_total <-
  urg_2017[urg_2017$Idcausa == 1 &
             urg_2017$idestablecimiento %in% estab_id, columns, drop = FALSE]
names(cons_total) <-
  c (
    "id",
    "cons_total_all",
    "cons_total_a1",
    "cons_total_1a4",
    "cons_total_5a14",
    "cons_total_15a64",
    "cons_total_65a",
    "date"
  )
cons_resp <-
  urg_2017[urg_2017$Idcausa == 2 &
             urg_2017$idestablecimiento %in% estab_id, columns, drop = FALSE]
names(cons_resp) <-
  c (
    "id",
    "cons_resp_all",
    "cons_resp_a1",
    "cons_resp_1a4",
    "cons_resp_5a14",
    "cons_resp_15a64",
    "cons_resp_65a",
    "date"
  )
cons_circ <-
  urg_2017[urg_2017$Idcausa == 12 &
             urg_2017$idestablecimiento %in% estab_id, columns, drop = FALSE]
names(cons_circ) <-
  c (
    "id",
    "cons_circ_all",
    "cons_circ_a1",
    "cons_circ_1a4",
    "cons_circ_5a14",
    "cons_circ_15a64",
    "cons_circ_65a",
    "date"
  )
cons_diarrea <-
  urg_2017[urg_2017$Idcausa == 29 &
             urg_2017$idestablecimiento %in% estab_id, columns, drop = FALSE]
names(cons_diarrea) <-
  c (
    "id",
    "cons_diarrea_all",
    "cons_diarrea_a1",
    "cons_diarrea_1a4",
    "cons_diarrea_5a14",
    "cons_diarrea_15a64",
    "cons_diarrea_65a",
    "date"
  )
cons_trauma <-
  urg_2017[urg_2017$Idcausa == 18 &
             urg_2017$idestablecimiento %in% estab_id, columns, drop = FALSE]
names(cons_trauma) <-
  c (
    "id",
    "cons_trauma_all",
    "cons_trauma_a1",
    "cons_trauma_1a4",
    "cons_trauma_5a14",
    "cons_trauma_15a64",
    "cons_trauma_65a",
    "date"
  )

# -------- Create Hospitalization Columns --------
hosp_total <-
  urg_2017[urg_2017$Idcausa == 25 &
             urg_2017$idestablecimiento %in% estab_id, columns, drop = FALSE]
names(hosp_total) <-
  c (
    "id",
    "hosp_total_all",
    "hosp_total_a1",
    "hosp_total_1a4",
    "hosp_total_5a14",
    "hosp_total_15a64",
    "hosp_total_65a",
    "date"
  )
hosp_resp <-
  urg_2017[urg_2017$Idcausa == 7 &
             urg_2017$idestablecimiento %in% estab_id, columns, drop = FALSE]
names(hosp_resp) <-
  c (
    "id",
    "hosp_resp_all",
    "hosp_resp_a1",
    "hosp_resp_1a4",
    "hosp_resp_5a14",
    "hosp_resp_15a64",
    "hosp_resp_65a",
    "date"
  )
hosp_circ <-
  urg_2017[urg_2017$Idcausa == 22 &
             urg_2017$idestablecimiento %in% estab_id, columns, drop = FALSE]
names(hosp_circ) <-
  c (
    "id",
    "hosp_circ_all",
    "hosp_circ_a1",
    "hosp_circ_1a4",
    "hosp_circ_5a14",
    "hosp_circ_15a64",
    "hosp_circ_65a",
    "date"
  )
hosp_trauma <-
  urg_2017[urg_2017$Idcausa == 23 &
             urg_2017$idestablecimiento %in% estab_id, columns, drop = FALSE]
names(hosp_trauma) <-
  c (
    "id",
    "hosp_trauma_all",
    "hosp_trauma_a1",
    "hosp_trauma_1a4",
    "hosp_trauma_5a14",
    "hosp_trauma_15a64",
    "hosp_trauma_65a",
    "date"
  )

# -------- Merge Columns Into One Dataset --------
cons <- merge(cons_total, cons_resp)
cons <- merge(cons, cons_circ)
cons <- merge(cons, cons_diarrea)
cons <- merge(cons, cons_trauma)

hosps <- merge(hosp_total, hosp_resp)
hosps <- merge(hosps, hosp_circ)
hosps <- merge(hosps, hosp_trauma)

urg17_3 <- merge(cons, hosps)

# -------- Write CSV File --------
#write_csv(urg17_3, "urg17_3.csv")
```

```{r 1 - Urg18_3 Data Creation}
# -------- Access Data --------
#rm(list=setdiff(ls(), "dt"))
establecimientos <-
  readr::read_delim("establecimientos.csv",
             ";",
             escape_double = FALSE,
             trim_ws = TRUE)

#d8 <- RODBC::odbcConnectAccess2007("AtencionesUrgencia2018.mdb")
#urg_2018 <- sqlFetch(d8, "AtencionesUrgencia2018")
#odbcClose(d8)

target <- tempfile()
file.path(target)
unzip(paste0(getwd(), '/',"AtencionesUrg_18.zip"), exdir = target)
f <- list.files(target, pattern = ".mdb")
d8 <- RODBC::odbcConnectAccess2007(file.path(target, f))
#d5 <- RODBC::odbcConnectAccess2007("AtencionesUrgencia2015.mdb")
urg_2018 <- sqlFetch(d8, "AtencionesUrgencia2018")
odbcClose(d8)
unlink(target)

# -------- Establish Hospital ID Codes --------
estab_id <-
  establecimientos[establecimientos$codigo_antiguo == "09-100" |
                     establecimientos$codigo_antiguo == "11-195" |
                     establecimientos$codigo_antiguo == "12-100", "codigo_antiguo", drop =
                     TRUE]
estab_id <- as.factor(estab_id)
columns = c("idestablecimiento",
            "Col01",
            "Col02",
            "Col03",
            "Col04",
            "Col05",
            "Col06",
            "fecha")

# -------- Create Consultation Columns --------
cons_total <-
  urg_2018[urg_2018$Idcausa == 1 &
             urg_2018$idestablecimiento %in% estab_id, columns, drop = FALSE]
names(cons_total) <-
  c (
    "id",
    "cons_total_all",
    "cons_total_a1",
    "cons_total_1a4",
    "cons_total_5a14",
    "cons_total_15a64",
    "cons_total_65a",
    "date"
  )
cons_resp <-
  urg_2018[urg_2018$Idcausa == 2 &
             urg_2018$idestablecimiento %in% estab_id, columns, drop = FALSE]
names(cons_resp) <-
  c (
    "id",
    "cons_resp_all",
    "cons_resp_a1",
    "cons_resp_1a4",
    "cons_resp_5a14",
    "cons_resp_15a64",
    "cons_resp_65a",
    "date"
  )
cons_circ <-
  urg_2018[urg_2018$Idcausa == 12 &
             urg_2018$idestablecimiento %in% estab_id, columns, drop = FALSE]
names(cons_circ) <-
  c (
    "id",
    "cons_circ_all",
    "cons_circ_a1",
    "cons_circ_1a4",
    "cons_circ_5a14",
    "cons_circ_15a64",
    "cons_circ_65a",
    "date"
  )
cons_diarrea <-
  urg_2018[urg_2018$Idcausa == 29 &
             urg_2018$idestablecimiento %in% estab_id, columns, drop = FALSE]
names(cons_diarrea) <-
  c (
    "id",
    "cons_diarrea_all",
    "cons_diarrea_a1",
    "cons_diarrea_1a4",
    "cons_diarrea_5a14",
    "cons_diarrea_15a64",
    "cons_diarrea_65a",
    "date"
  )
cons_trauma <-
  urg_2018[urg_2018$Idcausa == 18 &
             urg_2018$idestablecimiento %in% estab_id, columns, drop = FALSE]
names(cons_trauma) <-
  c (
    "id",
    "cons_trauma_all",
    "cons_trauma_a1",
    "cons_trauma_1a4",
    "cons_trauma_5a14",
    "cons_trauma_15a64",
    "cons_trauma_65a",
    "date"
  )

# -------- Create Hospitalization Columns --------
hosp_total <-
  urg_2018[urg_2018$Idcausa == 25 &
             urg_2018$idestablecimiento %in% estab_id, columns, drop = FALSE]
names(hosp_total) <-
  c (
    "id",
    "hosp_total_all",
    "hosp_total_a1",
    "hosp_total_1a4",
    "hosp_total_5a14",
    "hosp_total_15a64",
    "hosp_total_65a",
    "date"
  )
hosp_resp <-
  urg_2018[urg_2018$Idcausa == 7 &
             urg_2018$idestablecimiento %in% estab_id, columns, drop = FALSE]
names(hosp_resp) <-
  c (
    "id",
    "hosp_resp_all",
    "hosp_resp_a1",
    "hosp_resp_1a4",
    "hosp_resp_5a14",
    "hosp_resp_15a64",
    "hosp_resp_65a",
    "date"
  )
hosp_circ <-
  urg_2018[urg_2018$Idcausa == 22 &
             urg_2018$idestablecimiento %in% estab_id, columns, drop = FALSE]
names(hosp_circ) <-
  c (
    "id",
    "hosp_circ_all",
    "hosp_circ_a1",
    "hosp_circ_1a4",
    "hosp_circ_5a14",
    "hosp_circ_15a64",
    "hosp_circ_65a",
    "date"
  )
hosp_trauma <-
  urg_2018[urg_2018$Idcausa == 23 &
             urg_2018$idestablecimiento %in% estab_id, columns, drop = FALSE]
names(hosp_trauma) <-
  c (
    "id",
    "hosp_trauma_all",
    "hosp_trauma_a1",
    "hosp_trauma_1a4",
    "hosp_trauma_5a14",
    "hosp_trauma_15a64",
    "hosp_trauma_65a",
    "date"
  )

# -------- Merge Columns Into One Dataset --------
cons <- merge(cons_total, cons_resp)
cons <- merge(cons, cons_circ)
cons <- merge(cons, cons_diarrea)
cons <- merge(cons, cons_trauma)

hosps <- merge(hosp_total, hosp_resp)
hosps <- merge(hosps, hosp_circ)
hosps <- merge(hosps, hosp_trauma)

urg18_3 <- merge(cons, hosps)

# -------- Write CSV File --------
#write_csv(urg18_3, "urg18_3.csv")
```

```{r 1 - Urg19_3 Data Creation}
# -------- Access Data --------
#rm(list=setdiff(ls(), "dt"))
establecimientos <-
  readr::read_delim("establecimientos.csv",
             ";",
             escape_double = FALSE,
             trim_ws = TRUE)

#d9 <- RODBC::odbcConnectAccess2007("AtencionesUrgencia2019.mdb")
#urg_2019 <- sqlFetch(d9, "AtencionesUrgencia2019")
#odbcClose(d9)

target <- tempfile()
file.path(target)
unzip(paste0(getwd(), '/',"AtencionesUrg_19.zip"), exdir = target)
f <- list.files(target, pattern = ".mdb")
d9 <- RODBC::odbcConnectAccess2007(file.path(target, f))
#d5 <- RODBC::odbcConnectAccess2007("AtencionesUrgencia2015.mdb")
urg_2019 <- sqlFetch(d9, "AtencionesUrgencia2019")
odbcClose(d9)
urg_2019$idestablecimiento <- urg_2019$`?idestablecimiento`
unlink(target)

# -------- Establish Hospital ID Codes --------
estab_id <-
  establecimientos[establecimientos$codigo_antiguo == "09-100" |
                     establecimientos$codigo_antiguo == "11-195" |
                     establecimientos$codigo_antiguo == "12-100", "codigo_antiguo", drop =
                     TRUE]
estab_id <- as.factor(estab_id)
columns = c("idestablecimiento",
            "Col01",
            "Col02",
            "Col03",
            "Col04",
            "Col05",
            "Col06",
            "fecha")

# -------- Create Consultation Columns --------
cons_total <-
  urg_2019[urg_2019$Idcausa == 1 &
             urg_2019$idestablecimiento %in% estab_id, columns, drop = FALSE]
names(cons_total) <-
  c (
    "id",
    "cons_total_all",
    "cons_total_a1",
    "cons_total_1a4",
    "cons_total_5a14",
    "cons_total_15a64",
    "cons_total_65a",
    "date"
  )
cons_resp <-
  urg_2019[urg_2019$Idcausa == 2 &
             urg_2019$idestablecimiento %in% estab_id, columns, drop = FALSE]
names(cons_resp) <-
  c (
    "id",
    "cons_resp_all",
    "cons_resp_a1",
    "cons_resp_1a4",
    "cons_resp_5a14",
    "cons_resp_15a64",
    "cons_resp_65a",
    "date"
  )
cons_circ <-
  urg_2019[urg_2019$Idcausa == 12 &
             urg_2019$idestablecimiento %in% estab_id, columns, drop = FALSE]
names(cons_circ) <-
  c (
    "id",
    "cons_circ_all",
    "cons_circ_a1",
    "cons_circ_1a4",
    "cons_circ_5a14",
    "cons_circ_15a64",
    "cons_circ_65a",
    "date"
  )
cons_diarrea <-
  urg_2019[urg_2019$Idcausa == 29 &
             urg_2019$idestablecimiento %in% estab_id, columns, drop = FALSE]
names(cons_diarrea) <-
  c (
    "id",
    "cons_diarrea_all",
    "cons_diarrea_a1",
    "cons_diarrea_1a4",
    "cons_diarrea_5a14",
    "cons_diarrea_15a64",
    "cons_diarrea_65a",
    "date"
  )
cons_trauma <-
  urg_2019[urg_2019$Idcausa == 18 &
             urg_2019$idestablecimiento %in% estab_id, columns, drop = FALSE]
names(cons_trauma) <-
  c (
    "id",
    "cons_trauma_all",
    "cons_trauma_a1",
    "cons_trauma_1a4",
    "cons_trauma_5a14",
    "cons_trauma_15a64",
    "cons_trauma_65a",
    "date"
  )

# -------- Create Hospitalization Columns --------
hosp_total <-
  urg_2019[urg_2019$Idcausa == 25 &
             urg_2019$idestablecimiento %in% estab_id, columns, drop = FALSE]
names(hosp_total) <-
  c (
    "id",
    "hosp_total_all",
    "hosp_total_a1",
    "hosp_total_1a4",
    "hosp_total_5a14",
    "hosp_total_15a64",
    "hosp_total_65a",
    "date"
  )
hosp_resp <-
  urg_2019[urg_2019$Idcausa == 7 &
             urg_2019$idestablecimiento %in% estab_id, columns, drop = FALSE]
names(hosp_resp) <-
  c (
    "id",
    "hosp_resp_all",
    "hosp_resp_a1",
    "hosp_resp_1a4",
    "hosp_resp_5a14",
    "hosp_resp_15a64",
    "hosp_resp_65a",
    "date"
  )
hosp_circ <-
  urg_2019[urg_2019$Idcausa == 22 &
             urg_2019$idestablecimiento %in% estab_id, columns, drop = FALSE]
names(hosp_circ) <-
  c (
    "id",
    "hosp_circ_all",
    "hosp_circ_a1",
    "hosp_circ_1a4",
    "hosp_circ_5a14",
    "hosp_circ_15a64",
    "hosp_circ_65a",
    "date"
  )
hosp_trauma <-
  urg_2019[urg_2019$Idcausa == 23 &
             urg_2019$idestablecimiento %in% estab_id, columns, drop = FALSE]
names(hosp_trauma) <-
  c (
    "id",
    "hosp_trauma_all",
    "hosp_trauma_a1",
    "hosp_trauma_1a4",
    "hosp_trauma_5a14",
    "hosp_trauma_15a64",
    "hosp_trauma_65a",
    "date"
  )

# -------- Merge Columns Into One Dataset --------
cons <- merge(cons_total, cons_resp)
cons <- merge(cons, cons_circ)
cons <- merge(cons, cons_diarrea)
cons <- merge(cons, cons_trauma)

hosps <- merge(hosp_total, hosp_resp)
hosps <- merge(hosps, hosp_circ)
hosps <- merge(hosps, hosp_trauma)

urg19_3 <- merge(cons, hosps)

# -------- Write CSV File --------
#write_csv(urg19_3, "urg19_3.csv")
```

### Format Dates

We generated three variables regarding year, month and day of the date.

```{r 2 - Urg Data Cleaning, echo=FALSE}
Sys.setlocale(category = "LC_ALL", locale = "english")
`%>%`<- magrittr::`%>%`
# -------- Separate Date into YMD Columns - Urg15 within 3KM --------
urg15_3$date <- as.Date(urg15_3$date, "%d/%m/%Y")
urg15_3 <- urg15_3 %>%
  tidyr::separate(date, sep = "-", into = c("year", "month", "day"))
urg15_3$date <- as.Date(with(urg15_3, paste(year, month, day, sep = "-")))
urg15_3 <- urg15_3[, c(1, 59, 2:4, 5:58)]

# -------- Separate Date into YMD Columns - Urg16 within 3KM --------
urg16_3$date <- as.Date(urg16_3$date, "%d/%m/%Y")
urg16_3 <- urg16_3 %>%
  tidyr::separate(date, sep = "-", into = c("year", "month", "day"))
urg16_3$date <- as.Date(with(urg16_3, paste(year, month, day, sep = "-")))
urg16_3 <- urg16_3[, c(1, 59, 2:4, 5:58)]

# -------- Separate Date into YMD Columns - Urg17 within 3KM --------
urg17_3$date <- as.Date(urg17_3$date, "%d/%m/%Y")
urg17_3 <- urg17_3 %>%
  tidyr::separate(date, sep = "-", into = c("year", "month", "day"))
urg17_3$date <- as.Date(with(urg17_3, paste(year, month, day, sep = "-")))
urg17_3 <- urg17_3[, c(1, 59, 2:4, 5:58)]

# -------- Separate Date into YMD Columns - Urg18 within 3KM --------
urg18_3$date <- as.Date(urg18_3$date, "%d/%m/%Y")
urg18_3 <- urg18_3 %>%
  tidyr::separate(date, sep = "-", into = c("year", "month", "day"))
urg18_3$date <- as.Date(with(urg18_3, paste(year, month, day, sep = "-")))
urg18_3 <- urg18_3[, c(1, 59, 2:4, 5:58)]

# -------- Separate Date into YMD Columns - Urg19 within 3KM --------
urg19_3$date <- as.Date(urg19_3$date, "%d/%m/%Y")
urg19_3 <- urg19_3 %>%
  tidyr::separate(date, sep = "-", into = c("year", "month", "day"))
urg19_3$date <- as.Date(with(urg19_3, paste(year, month, day, sep = "-")))
urg19_3 <- urg19_3[, c(1, 59, 2:4, 5:58)]
```

### Single daily time-series per hospital

We constructed three single time-series databases containing information related to each hospital.

```{r 3 - Time Series (tsdata) Data Creation, echo=FALSE}
# -------- Isolate urg19_3 Hospital IDs 11-195 & 12-100 --------
# Isolate Hospital ID 09-100
urg19_3$date <- as.Date(urg19_3$date)
urg19_3_09100 <- urg19_3[urg19_3$id == "09-100", ]
urg19_3_09100$year <- as.character(urg19_3_09100$year)
urg19_3_09100 <- urg19_3_09100 %>%
  dplyr::group_by(date) %>%
  dplyr::summarise(
    id = id,
    year = year,
    month = month,
    day = day,
    cons_total_all = cons_total_all,
    cons_total_15a64 = cons_total_15a64,
    cons_total_65a = cons_total_65a,
    cons_resp_all = cons_resp_all,
    cons_resp_15a64 = cons_resp_15a64,
    cons_resp_65a = cons_resp_65a,
    cons_circ_all = cons_circ_all,
    cons_circ_15a64 = cons_circ_15a64,
    cons_circ_65a = cons_circ_65a,
    cons_diarrea_all = cons_diarrea_all,
    cons_diarrea_15a64 = cons_diarrea_15a64,
    cons_diarrea_65a = cons_diarrea_65a,
    cons_trauma_all = cons_trauma_all,
    cons_trauma_15a64 = cons_trauma_15a64,
    cons_trauma_65a = cons_trauma_65a,
    hosp_total_all = hosp_total_all,
    hosp_total_15a64 = hosp_total_15a64,
    hosp_total_65a = hosp_total_65a,
    hosp_resp_all = hosp_resp_all,
    hosp_resp_15a64 = hosp_resp_15a64,
    hosp_resp_65a = hosp_resp_65a,
    hosp_circ_all = hosp_circ_all,
    hosp_circ_15a64 = hosp_circ_15a64,
    hosp_circ_65a = hosp_circ_65a,
    hosp_trauma_all = hosp_trauma_all,
    hosp_trauma_15a64 = hosp_trauma_15a64,
    hosp_trauma_65a = hosp_trauma_65a
  )
urg19_3_09100 <- urg19_3_09100[, c(2, 1, 3:32)]

# Isolate Hospital ID 11-195
urg19_3_11195 <- urg19_3[urg19_3$id == "11-195", ]
urg19_3_11195$year <- as.character(urg19_3_11195$year)
urg19_3_11195 <- urg19_3_11195 %>%
  dplyr::group_by(date) %>%
  dplyr::summarise(
    id = id,
    year = year,
    month = month,
    day = day,
    cons_total_all = cons_total_all,
    cons_total_15a64 = cons_total_15a64,
    cons_total_65a = cons_total_65a,
    cons_resp_all = cons_resp_all,
    cons_resp_15a64 = cons_resp_15a64,
    cons_resp_65a = cons_resp_65a,
    cons_circ_all = cons_circ_all,
    cons_circ_15a64 = cons_circ_15a64,
    cons_circ_65a = cons_circ_65a,
    cons_diarrea_all = cons_diarrea_all,
    cons_diarrea_15a64 = cons_diarrea_15a64,
    cons_diarrea_65a = cons_diarrea_65a,
    cons_trauma_all = cons_trauma_all,
    cons_trauma_15a64 = cons_trauma_15a64,
    cons_trauma_65a = cons_trauma_65a,
    hosp_total_all = hosp_total_all,
    hosp_total_15a64 = hosp_total_15a64,
    hosp_total_65a = hosp_total_65a,
    hosp_resp_all = hosp_resp_all,
    hosp_resp_15a64 = hosp_resp_15a64,
    hosp_resp_65a = hosp_resp_65a,
    hosp_circ_all = hosp_circ_all,
    hosp_circ_15a64 = hosp_circ_15a64,
    hosp_circ_65a = hosp_circ_65a,
    hosp_trauma_all = hosp_trauma_all,
    hosp_trauma_15a64 = hosp_trauma_15a64,
    hosp_trauma_65a = hosp_trauma_65a
  )
urg19_3_11195 <- urg19_3_11195[, c(2, 1, 3:32)]

# Isolate Hospital ID 12-100
urg19_3_12100 <- urg19_3[urg19_3$id == "12-100", ]
urg19_3_12100$year <- as.character(urg19_3_12100$year)
urg19_3_12100 <- urg19_3_12100 %>%
  dplyr::group_by(date) %>%
  dplyr::summarise(
    id = id,
    year = year,
    month = month,
    day = day,
    cons_total_all = cons_total_all,
    cons_total_15a64 = cons_total_15a64,
    cons_total_65a = cons_total_65a,
    cons_resp_all = cons_resp_all,
    cons_resp_15a64 = cons_resp_15a64,
    cons_resp_65a = cons_resp_65a,
    cons_circ_all = cons_circ_all,
    cons_circ_15a64 = cons_circ_15a64,
    cons_circ_65a = cons_circ_65a,
    cons_diarrea_all = cons_diarrea_all,
    cons_diarrea_15a64 = cons_diarrea_15a64,
    cons_diarrea_65a = cons_diarrea_65a,
    cons_trauma_all = cons_trauma_all,
    cons_trauma_15a64 = cons_trauma_15a64,
    cons_trauma_65a = cons_trauma_65a,
    hosp_total_all = hosp_total_all,
    hosp_total_15a64 = hosp_total_15a64,
    hosp_total_65a = hosp_total_65a,
    hosp_resp_all = hosp_resp_all,
    hosp_resp_15a64 = hosp_resp_15a64,
    hosp_resp_65a = hosp_resp_65a,
    hosp_circ_all = hosp_circ_all,
    hosp_circ_15a64 = hosp_circ_15a64,
    hosp_circ_65a = hosp_circ_65a,
    hosp_trauma_all = hosp_trauma_all,
    hosp_trauma_15a64 = hosp_trauma_15a64,
    hosp_trauma_65a = hosp_trauma_65a
  )
urg19_3_12100 <- urg19_3_12100[, c(2, 1, 3:32)]

# Re-Bind Data with only ID 09-100, 11-195 & 12-100
urg19_3_clean <- rbind(urg19_3_09100, urg19_3_11195, urg19_3_12100)

# -------- Control Dataset - 3KM --------
urg_control_3 <- rbind(urg15_3, urg16_3, urg17_3, urg18_3)
```

### Sum of daily counts of hospitalizations and consultations

We generated an aggregated database containing the sum of daily counts of each type of consultation and hospitalization.

```{r 4 - Time Series (tsdata) Data Cleaning, echo=FALSE}
# -------- Sum Hospital ID Cases - urg19_3_clean --------
urg19_3_clean$date <- as.Date(urg19_3_clean$date)

urg19_3_clean_cons <- urg19_3_clean %>%
  dplyr::group_by(date) %>%
  dplyr::summarise(
    year = unique(year),
    month = unique(month),
    day = unique(day),
    cons_total_all = sum(cons_total_all),
    cons_total_15a64 = sum(cons_total_15a64),
    cons_total_65a = sum(cons_total_65a),
    cons_resp_all = sum(cons_resp_all),
    cons_resp_15a64 = sum(cons_resp_15a64),
    cons_resp_65a = sum(cons_resp_65a),
    cons_circ_all = sum(cons_circ_all),
    cons_circ_15a64 = sum(cons_circ_15a64),
    cons_circ_65a = sum(cons_circ_65a),
    cons_diarrea_all = sum(cons_diarrea_all),
    cons_diarrea_15a64 = sum(cons_diarrea_15a64),
    cons_diarrea_65a = sum(cons_diarrea_65a),
    cons_trauma_all = sum(cons_trauma_all),
    cons_trauma_15a64 = sum(cons_trauma_15a64),
    cons_trauma_65a = sum(cons_trauma_65a),
    hosp_total_all = sum(hosp_total_all),
    hosp_total_15a64 = sum(hosp_total_15a64),
    hosp_total_65a = sum(hosp_total_65a),
    hosp_resp_all = sum(hosp_resp_all),
    hosp_resp_15a64 = sum(hosp_resp_15a64),
    hosp_resp_65a = sum(hosp_resp_65a),
    hosp_circ_all = sum(hosp_circ_all),
    hosp_circ_15a64 = sum(hosp_circ_15a64),
    hosp_circ_65a = sum(hosp_circ_65a),
    hosp_trauma_all = sum(hosp_trauma_all),
    hosp_trauma_15a64 = sum(hosp_trauma_15a64),
    hosp_trauma_65a = sum(hosp_trauma_65a)
  )
# -------- Sum Hospital ID Cases - tsdata3 --------
urg_control_3$date <- as.Date(urg_control_3$date)

urg_control_3_cons <- urg_control_3 %>%
  dplyr::group_by(date) %>%
  dplyr::summarise(
    year = unique(year),
    month = unique(month),
    day = unique(day),
    cons_total_all = sum(cons_total_all),
    cons_total_15a64 = sum(cons_total_15a64),
    cons_total_65a = sum(cons_total_65a),
    cons_resp_all = sum(cons_resp_all),
    cons_resp_15a64 = sum(cons_resp_15a64),
    cons_resp_65a = sum(cons_resp_65a),
    cons_circ_all = sum(cons_circ_all),
    cons_circ_15a64 = sum(cons_circ_15a64),
    cons_circ_65a = sum(cons_circ_65a),
    cons_diarrea_all = sum(cons_diarrea_all),
    cons_diarrea_15a64 = sum(cons_diarrea_15a64),
    cons_diarrea_65a = sum(cons_diarrea_65a),
    cons_trauma_all = sum(cons_trauma_all),
    cons_trauma_15a64 = sum(cons_trauma_15a64),
    cons_trauma_65a = sum(cons_trauma_65a),
    hosp_total_all = sum(hosp_total_all),
    hosp_total_15a64 = sum(hosp_total_15a64),
    hosp_total_65a = sum(hosp_total_65a),
    hosp_resp_all = sum(hosp_resp_all),
    hosp_resp_15a64 = sum(hosp_resp_15a64),
    hosp_resp_65a = sum(hosp_resp_65a),
    hosp_circ_all = sum(hosp_circ_all),
    hosp_circ_15a64 = sum(hosp_circ_15a64),
    hosp_circ_65a = sum(hosp_circ_65a),
    hosp_trauma_all = sum(hosp_trauma_all),
    hosp_trauma_15a64 = sum(hosp_trauma_15a64),
    hosp_trauma_65a = sum(hosp_trauma_65a)
  )

save.image(paste0(getwd(),"/","Procesos hasta 4_2.RData"))
```

\# Session Info

```{r save, echo=T, cache= T, paged.print=TRUE, warning=F, eval=T}
Sys.getenv("R_LIBS_USER")

rstudioapi::getSourceEditorContext()

#paste0("Folder where packages were saved: ",get.groundhog.folder())

sessionInfo()

#carsData <- read.table(unz(temp, "a1.dat"))
#unlink(temp)
```
